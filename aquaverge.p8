pico-8 cartridge // http://www.pico-8.com
version 41
__lua__

#include data/inf_crumbs.txt
#include data/inf_spawns.txt
#include data/inf_patterns.txt
#include data/inf_sprites.txt
#include data/inf_enems.txt

#include src/mapfuncs.lua
#include src/sprfuncs.lua
#include src/bulfuncs.lua

#include base_shmup.lua
#include debugfuncs.lua

function _init()
	t=0

	init_baseshmup(enemy_data)
	init_sprfuncs(spr_library,anim_library)
	init_mapfuncs(enemy_spawns,crumb_lib,shot_lib)
	init_bulfuncs(bul_library)

	pal({[0]=128,133,141,7,129,1,140,12,134,6,136,8,3,139,11,10},1)
	palt(0,false)
end


function _update60()
	t+=1

	upd_mapfuncs()
	upd_bulfuncs()

	foreach(enems,follow_path)

	player_movement()
	player_shoot()

	foreach(puls,upd_pul)
end


function _draw()
	cls(6)

	enem_draw_under=true						-- this is a sneaky way to preserve the foreach loop
	foreach(enems,drw_enem)						-- draw the enemies
	
	foreach(puls,drw_pul)						-- player projectiles
	muzzle_flash()								-- muzzle flash (unsurprisingly)

	fillp(â–’)
	circfill(delx+4,dely+6,7,5)
	sspr_obj(flr(bnk+3),player_x,player_y)		-- player sprite
	fillp()

	enem_draw_under=false						
	foreach(enems,drw_enem)

	foreach(hitregs,drw_hitreg)

	drw_bulfuncs()								-- enemy projectiles

	-- debug_hitboxes()
	drw_debug()
end


__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006611116600000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006129391600000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001229399100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001229399100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001229399100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001200009100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001011110100000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000111111000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111111166666666
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100001196666698
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001109001114666648
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001129221195454569
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001119111195555556
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002222222219545458
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004544445411455588
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004444444454554545
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004444444444444444
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004544444445666544
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004454454446666654
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004444445445666664
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004444444456666665
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005454444566666666
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006545445666666666
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006655556666666666
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddd00dddddd00d32dddddddddddddddddd33ddd339d000000000000000000000000000000000000000000000000000000000000e330000000000000003300
ddddd0200000001239ddddddd2ddddddddddd913dd91d200000000000000000000000000000000000000000000000000000000000eddd3000eee33300003ee30
ddddd0201b1101ab39dddddd9ddddddddddd9dd2dd9ddd00000000000000000000000000000000000000000000000000000000000deee300edcedce300ecdde3
ddddd0202a220a22dd929ddd31d29993ddd29ddddd29dd00000000000000000000000000000000000000000000000000000000000eccce00edcedce30ececdd1
ddddd02000000120ddd129dd39912d13ddd12ddddd12dd00000000000000000000000000000000000000000000000000000000000cdddc00ddcedcedcddcec10
dddddd00dddd0102dddddd93ddddddd92dd9ddddddd9dd00000000000000000000000000000000000000000000000000000000000dcccd001cccccc11cddc100
dd111dddddd01202dddddd93dddddd2d319ddddd2d19dd000000000000000000000000000000000000000000000000000000000001ccc1000111111001cc1000
d12221dddd012022ddddd23dddddddddd33dddddd933dd0000000000000000000000000000000000000000000000000000000000001110000000000000110000
1211121dd01220110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa00000aa00000aaaa00
0200020000122222000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000abbba00aabbaa00ab22ba0
002220022012200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ab232baabb22bba0ab33ba0
0200010220120b330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ab2333baa233332aab2332ba
0b221a0000120bbb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ab3332baa233332aab2332ba
02bba1021010aabb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ab232ba0abb22bba0ab33ba0
d02110221010aaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000abbba000aabbaa00ab22ba0
dd00002ba0120aaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000aaa000000aa00000aaaa00
ddddd0b210120aaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddd022110120aa0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddd0200101120a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddd001100011200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddd010010d01110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddd010010dd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
dddddd0110dddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ddddddd00ddddddd0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaaeeaaaaaa3333aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa33eaaaa333333aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa333eaa3333a333a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa3333e33333aa33300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aaa3333e3333aaaa3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aee3333e3333aaaa3300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eee333ee33333aa33300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eee33eeaa3333a333a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
eeeeeeaaaa333333aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
aeeeeaaaaaa3333aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
444aaa444aaaa444aaaa444aaaaa444aaaaaa444aaaa444aaaaa444aaaa444aaa444000000000000000000000000000000000000000000000000000000000000
4944a449444aa4944aaa49444aa44944aaaa44944aa44944aaa4494aa444944a449400000000000000000030dd0f00fff000fff0000000000000000000000000
42e44422e244442d44aa42de4444c2e4aaaa4c2e4444c2e4aa44c244441c22444c240000000000000000003dfff3ff333f0f333f000000000000000000000000
42de4442dd244c2de4aa42dde44cc2e4aaaa4c2de44cc2e4aa4cc2e441cc2444cc240000000000000000303f33333f333ff33333f00000000000000000000000
424d44424d244c24e444424de44cc2e444444c2de44c42e4444c42e441c42444c4240000000000000d003d3333333f333ff33333f00000000000000000000000
42cdcde2cd244c2ceced42cde44cc2e44ce44c2de44cd2e4ce4cd2e441cd24decd240000000000000f003f3333333f333ff33333f00000000000000000000000
42ccced2cd244c2cdccec2cde44cc2e4ccee4c2de44cd2ecceecd2e441cd2cdeed24000000000000e300333333333f333ff33333f00000000000000000000000
42c444e2cd244c2cc44de2cde44cc2ecc44eec2de44cd2ecc44ed2e441cd2c444d24000000000000f300333333f3ff333ff33333f00000000000000000000000
424734e2cd44442c4734e2cd4444c2ec4734ec2d4444d2ec4734d24444cd2c47342400000000f00ef3f0333333f3fef3fef33333f00000000000000000000000
434674e3cd4aa43c4674e3cd4aa4c3ec4674ec3d4aa4d3ec4674d34aa4cd3c4674340000000f300f333d333333f3fef3fee33333e00000000000000000000000
434564e3cd44443c4564e3cd4444c3ec4564ec3d4444d3ec4664d34444cd3c46643400f0000f300f3333333333f3fef3feef333fe00000000000000000000000
41c444e1cd244c1cc44ec1cde44cc1ecc44eec1de44cd1edc44ed1e441cd1c444d140f30000f30f33333333333f3fef3feeef3fee00000000000000000000000
41ccded1dd244c1dccedc1dde44cc1eccddecc1de44cc1eddeedc1e441cc1cdedc140f30ff0f30f33333333333f3fef3fee0f3f0e00000000000000000000000
41c1c1d1dd244c1d1ccc11dce44cc1e1cccc1c1de44cc1ddcccdc1e441cc1ccccc140f3f33ff3f333333333333f3fef3fee0f3f0e00000000000000000000000
44cc19cdd24444cdc192ddce4444cde412914cde4444cddd231cde44441cdc29cce40f3f33333ff333d3333333efedefed00f3f0000000000000000000000000
a44c44ccc44aa44cc4444cc44aa44cc444444cc44aa44cc4444cc44aa441cc44ce440f30d33330df330d333333ded0ded000f3f0000000000000000000000000
aa44444444aaaa4444aa4444aaaa4444aaaa4444aaaa4444aa4444aaaa444444444a00f00df3300df300df33330d000d00000300000000000000000000000000
